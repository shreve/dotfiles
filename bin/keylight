#!/bin/bash

# Vadim Zaliva lord@crocodile.org
# based on https://gist.github.com/hadess/6847281

# if [ sudo -n true 2>/dev/null ]; then
#     echo "You are sudo"
# else
#    echo "This script performs sudo commands." 1>&2
# fi

FILEPATH="/sys/devices/platform/thinkpad_acpi/leds/tpacpi::kbd_backlight/brightness"
CURRENT=$(sudo cat $FILEPATH)

set () {
    new=$1
    if [ $(expr "$new < 0" | bc) -eq '1' ]; then
        new='0'
    fi
    if [ $(expr "$new > 2" | bc) -eq '1' ]; then
        new='2'
    fi
    echo $new | sudo dd of=$FILEPATH &> /dev/null
}

increase() {
    set $(expr "$CURRENT + 1" | bc)
}

decrease() {
    set $(expr "$CURRENT - 1" | bc)
}

turn_off() {
    set '0'
}

usage() {
   echo "This script controls keyboard backlight on IBM ThinkPad X-series"
   echo "Usage: keylight command"
   echo "   up, on - increase the brightness"
   echo "   down - decrease the brightness"
   echo "   off - decrease to off"
}

if [ "$#" -ne 1 ];then
   usage
   exit 1
fi

case "$1" in
        "up"|"on")
            increase
            ;;
        "down")
            decrease
            ;;
        "off")
            turn_off
            ;;
        *)
            usage
            exit 1
esac
