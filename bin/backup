#!/usr/bin/env bash

REPO=/media/jacob/Backup/thinkpad.attic
home=/home/jacob

attic create --stats \
      "$REPO::$(date +%Y-%m-%d)" $home \
      --exclude $home/.cache \
      --exclude $home/.rbenv  \
      --exclude $home/.config/chromium \
      --exclude $home/.config/google-chrome \
      --exclude $home/.config/Slack \
      --exclude .npm \
      --verbose

attic prune -v "$REPO" --keep-daily=7 --keep-weekly=4 --keep-monthly=12

#
#  This rsync based solution is outdated, but I'll keep it around for now
#
#
#
# EXIT_CODE=1;

# perform_backup() {
#     echo "Starting backup to sync server" >&2
#     rsync --verbose --recursive --links --perms --times \
#           --delete --compress --ignore-existing --archive \
#           --human-readable \
#           --exclude=.cache* \
#           --exclude=cache* \
#           --exclude=.rbenv* \
#           --exclude=.ssh/ \
#           --exclude=*.DS_Store \
#           --exclude=*.log \
#           --exclude=Downloads \
#           --exclude=.config/google-chrome \
#           --exclude=.config/chromium \
#           --exclude=.config/Slack \
#           --exclude=.mozilla \
#           --exclude=.npm \
#           ~ sync:/home
#     # sync is configured in ~/.ssh/config
#     EXIT_CODE=$?;
# }

# perform_backup;

# while [ $EXIT_CODE -gt 0 ] && [ ! $EXIT_CODE -eq 20 ]; do
#     echo "Exited with code " $EXIT_CODE
#     echo "Retrying shortly...";
#     sleep 3;
#     perform_backup;
# done
