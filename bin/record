#!/usr/bin/env ruby

require 'json'

case ARGV[0]
when 'current'
  rect = `current_window rect`
  rect = JSON.parse(rect)
  x, y, width, height = rect.values
  y += 3
  height -= 3
  width -= 3
  duration = ARGV[1] || 10
  filename = Time.now.strftime "%Y-%m-%d--%H-%M-%S--#{width}x#{height}--#{duration}s.gif"
  filename = File.expand_path("~/Pictures/screenshots/#{filename}")
  cmd = "byzanz-record --duration=#{duration} --delay=2 " \
        "-x #{x} -y #{y} " \
        "-w #{width} -h #{height} #{filename}"
  puts cmd
  fork do
    puts `#{cmd}`
    `notify-send "Recording Complete"`
  end
end
